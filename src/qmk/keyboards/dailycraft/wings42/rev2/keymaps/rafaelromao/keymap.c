#include QMK_KEYBOARD_H

#include "rafaelromao.h"

#define LAYOUT_wrapper(...) LAYOUT_split_3x6_3_2(__VA_ARGS__)

// clang-format off

// Keymap

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {

     [_ALPHA1] = LAYOUT_wrapper(
    //,---------+---------+---------+---------+---------+---------.                       ,---------+---------+---------+---------+---------+---------.
        XXXXXXX , __________________HDNVP1_L1____________________ ,                         __________________HDNVP1_R1____________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╔════════╗  ╔════════╗ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , __________________HDNVP1_L2____________________ , XXXXXXX ,   XXXXXXX ,   __________________HDNVP1_R2____________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╠════════╣  ╠════════╣ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , __________________HDNVP1_L3____________________ , XXXXXXX ,   XXXXXXX ,   __________________HDNVP1_R3____________________ , XXXXXXX ,
    //`---------+---------+---------+---------+---------+---------/╚════════╝  ╚════════╝ \---------+---------+---------+---------+---------+---------'
                                                __________HDNVP1_L4________ ,     ________HDNVP1_R4__________
    //                                       `+---------+---------+---------'   `---------+---------+---------+'
    ),

    [_NUMPAD] = LAYOUT_wrapper(
    //,---------+---------+---------+---------+---------+---------.                       ,---------+---------+---------+---------+---------+---------.
        XXXXXXX , ___________________NUMPAD_L1_________ , XXXXXXX ,                         XXXXXXX , _________NUMPAD_R1___________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╔════════╗  ╔════════╗ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , ___________________NUMPAD_L2___________________ , XXXXXXX ,   XXXXXXX ,   ___________________NUMPAD_R2___________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╠════════╣  ╠════════╣ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , _______ , _________NUMPAD_L3___________________ , XXXXXXX ,   XXXXXXX ,   ___________________NUMPAD_R3_________ , XXXXXXX , XXXXXXX ,
    //`---------+---------+---------+---------+---------+---------/╚════════╝  ╚════════╝ \---------+---------+---------+---------+---------+---------'
                                                XXXXXXX , ____NUMPAD_L4____ ,     ____NUMPAD_R4____ , XXXXXXX
    //                                       `+---------+---------+---------'   `---------+---------+---------+'


     [_SHORTCUTS] = LAYOUT_wrapper(
    //,---------+---------+---------+---------+---------+---------.                       ,---------+---------+---------+---------+---------+---------.
        XXXXXXX , ________________SHORTCUTS_L1_________ , XXXXXXX ,                         XXXXXXX , ______SHORTCUTS_R1___________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╔════════╗  ╔════════╗ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , ________________SHORTCUTS_L2___________________ , XXXXXXX ,   XXXXXXX ,   ________________SHORTCUTS_R2___________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╠════════╣  ╠════════╣ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , _______ , ______SHORTCUTS_L3___________________ , XXXXXXX ,   XXXXXXX ,   ________________SHORTCUTS_R3_________ , XXXXXXX , XXXXXXX ,
    //`---------+---------+---------+---------+---------+---------/╚════════╝  ╚════════╝ \---------+---------+---------+---------+---------+---------'
                                                XXXXXXX , _SHORTCUTS_L4____ ,     _SHORTCUTS_R4____ , XXXXXXX
    //                                       `+---------+---------+---------'   `---------+---------+---------+'
    ),


    [_NOMOD] = LAYOUT_wrapper(
    //,---------+---------+---------+---------+---------+---------.                       ,---------+---------+---------+---------+---------+---------.
        XXXXXXX , ___________________NOMOD_L1__________ , _______ ,                         _______ , _________NOMOD_R1____________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╔════════╗  ╔════════╗ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , ___________________NOMOD_L2____________________ , XXXXXXX ,   XXXXXXX ,   ___________________NOMOD_R2____________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╠════════╣  ╠════════╣ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , _______ , _________NOMOD_L3____________________ , XXXXXXX ,   XXXXXXX ,  ___________________NOMOD_R3__________ , _______  , XXXXXXX ,
    //`---------+---------+---------+---------+---------+---------/╚════════╝  ╚════════╝ \---------+---------+---------+---------+---------+---------'
                                                _______ , ____NOMOD_L4_____ ,     ____NOMOD_R4_____, _______
    //                                       `+---------+---------+---------'   `---------+---------+---------+'
    ),

    [_ALPHA2] = LAYOUT_wrapper(
    //,---------+---------+---------+---------+---------+---------.                       ,---------+---------+---------+---------+---------+---------.
        XXXXXXX , ___________________HDNVP2_L1___________________ ,                         ___________________HDNVP2_R1___________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╔════════╗  ╔════════╗ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , ___________________HDNVP2_L2___________________ , XXXXXXX ,   XXXXXXX ,   ___________________HDNVP2_R2___________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╠════════╣  ╠════════╣ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , ___________________HDNVP2_L3___________________ , XXXXXXX ,   XXXXXXX ,   ___________________HDNVP2_R3___________________ , XXXXXXX ,
    //`---------+---------+---------+---------+---------+---------/╚════════╝  ╚════════╝ \---------+---------+---------+---------+---------+---------'
                                                __________HDNVP2_L4________ ,     ________HDNVP2_R4__________
    //                                       `+---------+---------+---------'   `---------+---------+---------+'
    ),

     [_FIXED_ALPHA2] = LAYOUT_wrapper(
    //,---------+---------+---------+---------+---------+---------.                       ,---------+---------+---------+---------+---------+---------.
        XXXXXXX , ___________________HDNVP2_L1___________________ ,                         ___________________HDNVP2_R1___________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╔════════╗  ╔════════╗ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , ___________________HDNVP2_L2___________________ , XXXXXXX ,   XXXXXXX ,   ___________________HDNVP2_R2___________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╠════════╣  ╠════════╣ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , ___________________HDNVP2_L3___________________ , XXXXXXX ,   XXXXXXX ,   ___________________HDNVP2_R3___________________ , XXXXXXX ,
    //`---------+---------+---------+---------+---------+---------/╚════════╝  ╚════════╝ \---------+---------+---------+---------+---------+---------'
                                                __________HDNVP2_L4________ ,     ________HDNVP2_R4__________
    //                                       `+---------+---------+---------'   `---------+---------+---------+'
    ),

    [_LOWER] = LAYOUT_wrapper(
    //,---------+---------+---------+---------+---------+---------.                       ,---------+---------+---------+---------+---------+---------.
        XXXXXXX , ___________________LOWER_L1__________ , _______ ,                         _______ , _________LOWER_R1____________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╔════════╗  ╔════════╗ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , ___________________LOWER_L2____________________ , XXXXXXX ,   XXXXXXX ,   ___________________LOWER_R2____________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╠════════╣  ╠════════╣ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , XXXXXXX , _________LOWER_L3____________________ , XXXXXXX ,   XXXXXXX ,   ___________________LOWER_R3__________ , XXXXXXX , XXXXXXX ,
    //`---------+---------+---------+---------+---------+---------/╚════════╝  ╚════════╝ \---------+---------+---------+---------+---------+---------'
                                                XXXXXXX , ____LOWER_L4_____ ,     ____LOWER_R4_____ , XXXXXXX
    //                                       `+---------+---------+---------'   `---------+---------+---------+'
    ),

     [_RAISE] = LAYOUT_wrapper(
    //,---------+---------+---------+---------+---------+---------.                       ,---------+---------+---------+---------+---------+---------.
        XXXXXXX , ___________________RAISE_L1__________ , _______ ,                         _______ , _________RAISE_R1____________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╔════════╗  ╔════════╗ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , ___________________RAISE_L2____________________ , XXXXXXX ,   XXXXXXX ,   ___________________RAISE_R2____________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╠════════╣  ╠════════╣ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , XXXXXXX , _________RAISE_L3____________________ , XXXXXXX ,   XXXXXXX ,   ___________________RAISE_R3__________ , XXXXXXX , XXXXXXX ,
    //`---------+---------+---------+---------+---------+---------/╚════════╝  ╚════════╝ \---------+---------+---------+---------+---------+---------'
                                                XXXXXXX , _______ , _______ ,     _______ , _______ , XXXXXXX
    //                                       `+---------+---------+---------'   `---------+---------+---------+'
    ),

    [_SYMBOLS] = LAYOUT_wrapper(
    //,---------+---------+---------+---------+---------+---------.                       ,---------+---------+---------+---------+---------+---------.
        XXXXXXX , _________________SYMBOLS_L1__________ , XXXXXXX ,                         XXXXXXX , _______SYMBOLS_R1____________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╔════════╗  ╔════════╗ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , _________________SYMBOLS_L2____________________ , XXXXXXX ,   XXXXXXX ,   _________________SYMBOLS_R2____________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╠════════╣  ╠════════╣ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , XXXXXXX , _______SYMBOLS_L3____________________ , XXXXXXX ,   XXXXXXX ,   _________________SYMBOLS_R3__________ , XXXXXXX , XXXXXXX ,
    //`---------+---------+---------+---------+---------+---------/╚════════╝  ╚════════╝ \---------+---------+---------+---------+---------+---------'
                                                XXXXXXX , _______ , _______ ,     _______ , _______ , XXXXXXX
    //                                       `+---------+---------+---------'   `---------+---------+---------+'
    ),

     [_FIXED_NAV] = LAYOUT_wrapper(
    //,---------+---------+---------+---------+---------+---------.                       ,---------+---------+---------+---------+---------+---------.
        XXXXXXX , ___________________NAVIGATION_L1_____ , XXXXXXX ,                         XXXXXXX , _________NAVIGATION_R1_______________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╔════════╗  ╔════════╗ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , ___________________NAVIGATION_L2_______________ , XXXXXXX ,   XXXXXXX ,   ___________________NAVIGATION_R2_______________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╠════════╣  ╠════════╣ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , XXXXXXX , _________NAVIGATION_L3_______________ , XXXXXXX ,   XXXXXXX ,   ___________________NAVIGATION_R3_____ , XXXXXXX , XXXXXXX ,
    //`---------+---------+---------+---------+---------+---------/╚════════╝  ╚════════╝ \---------+---------+---------+---------+---------+---------'
                                                XXXXXXX , ____MEDIA_L4_____ ,     ____MEDIA_R4_____ , XXXXXXX
    //                                       `+---------+---------+---------'   `---------+---------+---------+'
    ),

    [_MEDIA] = LAYOUT_wrapper(
    //,---------+---------+---------+---------+---------+---------.                       ,---------+---------+---------+---------+---------+---------.
        XXXXXXX , ___________________MEDIA_L1__________ , _______ ,                         _______ , _________MEDIA_R1____________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╔════════╗  ╔════════╗ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , ___________________MEDIA_L2____________________ , XXXXXXX ,   XXXXXXX ,   ___________________MEDIA_R2____________________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╠════════╣  ╠════════╣ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , XXXXXXX , _________MEDIA_L3____________________ , XXXXXXX ,   XXXXXXX ,   ___________________MEDIA_R3__________ , XXXXXXX , XXXXXXX ,
    //`---------+---------+---------+---------+---------+---------/╚════════╝  ╚════════╝ \---------+---------+---------+---------+---------+---------'
                                                XXXXXXX , ____MEDIA_L4_____ ,     ____MEDIA_R4_____ , XXXXXXX
    //                                       `+---------+---------+---------'   `---------+---------+---------+'
    ),


    [_NAVIGATION] = LAYOUT_wrapper(
    //,---------+---------+---------+---------+---------+---------.                       ,---------+---------+---------+---------+---------+---------.
        XXXXXXX , ___________________NAVIGATION_L1_____ , _______ ,                         _______ , _________NAVIGATION_R1_______________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╔════════╗  ╔════════╗ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , ___________________NAVIGATION_L2_______________ , XXXXXXX ,   XXXXXXX ,   ___________________NAVIGATION_R2_______________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╠════════╣  ╠════════╣ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , _______ , _________NAVIGATION_L3_______________ , XXXXXXX ,   XXXXXXX ,   ___________________NAVIGATION_R3_____ , _______ , XXXXXXX ,
    //`---------+---------+---------+---------+---------+---------/╚════════╝  ╚════════╝ \---------+---------+---------+---------+---------+---------'
                                                XXXXXXX , __NAVIGATION_L4__ ,     __NAVIGATION_R4__ , XXXXXXX
    //                                       `+---------+---------+---------'   `---------+---------+---------+'
    ),

    [_LOCK] = LAYOUT_wrapper(
    //,---------+---------+---------+---------+---------+---------.                       ,---------+---------+---------+---------+---------+---------.
        XXXXXXX , _______________________LOCK____L1____ , XXXXXXX ,                         XXXXXXX , _____________LOCK____R1______________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╔════════╗  ╔════════╗ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , _______________________LOCK____L2______________ , XXXXXXX ,   XXXXXXX ,   _______________________LOCK____R2______________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╠════════╣  ╠════════╣ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , XXXXXXX , _____________LOCK____L3______________ , XXXXXXX ,   XXXXXXX ,   _______________________LOCK____R3____ , XXXXXXX , XXXXXXX ,
    //`---------+---------+---------+---------+---------+---------/╚════════╝  ╚════════╝ \---------+---------+---------+---------+---------+---------'
                                                XXXXXXX , ______LOCK____L4_ ,     ______LOCK____R4_ , XXXXXXX
    //                                       `+---------+---------+---------'   `---------+---------+---------+'
    ),

    [_SYSTEM] = LAYOUT_wrapper(
    //,---------+---------+---------+---------+---------+---------.                       ,---------+---------+---------+---------+---------+---------.
        XXXXXXX , ______________________SYSTEM___L1____ , XXXXXXX ,                         XXXXXXX , ____________SYSTEM___R1______________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╔════════╗  ╔════════╗ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , ______________________SYSTEM___L2______________ , XXXXXXX ,   XXXXXXX ,   ______________________SYSTEM___R2______________ , XXXXXXX ,
    //|---------+---------+---------+---------+---------+---------|╠════════╣  ╠════════╣ |---------+---------+---------+---------+---------+---------|
        XXXXXXX , XXXXXXX , ____________SYSTEM___L3______________ , XXXXXXX ,   XXXXXXX ,   ______________________SYSTEM___R3____ , XXXXXXX , XXXXXXX ,
    //`---------+---------+---------+---------+---------+---------/╚════════╝  ╚════════╝ \---------+---------+---------+---------+---------+---------'
                                                XXXXXXX , _____SYSTEM___L4_ ,     _____SYSTEM___R4_ , XXXXXXX
    //                                       `+---------+---------+---------'   `---------+---------+---------+'
    )
};

// clang-format on


// Encoder Map

#if defined(ENCODER_MAP_ENABLE)
const uint16_t PROGMEM encoder_map[][NUM_ENCODERS][4] = {
    [_ALPHA1]         = {ENCODER_CCW_CW(S(KC_PGUP), S(KC_PGDN)), ENCODER_CCW_CW(KC_VOLD, KC_VOLU)},
    [_NUMPAD]         = {ENCODER_CCW_CW(S(KC_PGUP), S(KC_PGDN)), ENCODER_CCW_CW(KC_VOLD, KC_VOLU)},
    [_ALPHA2]         = {ENCODER_CCW_CW(S(KC_PGUP), S(KC_PGDN)), ENCODER_CCW_CW(KC_VOLD, KC_VOLU)},
    [_SHORTCUTS]      = {ENCODER_CCW_CW(S(KC_PGUP), S(KC_PGDN)), ENCODER_CCW_CW(KC_VOLD, KC_VOLU)},
    [_SYMBOLS]        = {ENCODER_CCW_CW(S(KC_PGUP), S(KC_PGDN)), ENCODER_CCW_CW(KC_VOLD, KC_VOLU)},
    [_LOWER]          = {ENCODER_CCW_CW(S(KC_PGUP), S(KC_PGDN)), ENCODER_CCW_CW(KC_VOLD, KC_VOLU)},
    [_RAISE]          = {ENCODER_CCW_CW(S(KC_PGUP), S(KC_PGDN)), ENCODER_CCW_CW(KC_VOLD, KC_VOLU)},
    [_FIXED_NAV]      = {ENCODER_CCW_CW(S(KC_PGUP), S(KC_PGDN)), ENCODER_CCW_CW(KC_VOLD, KC_VOLU)},
    [_NAVIGATION]     = {ENCODER_CCW_CW(S(KC_PGUP), S(KC_PGDN)), ENCODER_CCW_CW(KC_VOLD, KC_VOLU)},
    [_MEDIA]          = {ENCODER_CCW_CW(S(KC_PGUP), S(KC_PGDN)), ENCODER_CCW_CW(KC_VOLD, KC_VOLU)},
    [_LOCK]           = {ENCODER_CCW_CW(S(KC_PGUP), S(KC_PGDN)), ENCODER_CCW_CW(KC_VOLD, KC_VOLU)},
    [_SYSTEM]         = {ENCODER_CCW_CW(S(KC_PGUP), S(KC_PGDN)), ENCODER_CCW_CW(KC_VOLD, KC_VOLU)}};
#endif

// Oled

void clear_oled(void) {
    oled_write("                ", false);
}

void set_oled_by_layer(uint32_t layer) {
    if (is_suspended) {
        oled_set_cursor(0, 0);
        clear_oled();
        return;
    }
    switch (layer) {
        case _ALPHA1:
        case _NOMOD:
            oled_write("        ROMAK     ", false);
            break;
        case _NUMPAD:
            oled_write("        NUMPAD    ", false);
            break;
        case _ALPHA2:
        case _FIXED_ALPHA2:
            oled_write("        ALPHA2    ", false);
            break;
        case _SHORTCUTS:
            oled_write("      SHORTCUTS   ", false);
            break;
        case _SYMBOLS:
            oled_write("      SYMBOLS     ", false);
            break;
        case _LOWER:
            oled_write("        LOWER     ", false);
            break;
        case _RAISE:
            oled_write("        RAISE     ", false);
            break;
        case _FIXED_NAV:
        case _NAVIGATION:
            oled_write("      NAVIGATION  ", false);
            break;
        case _MEDIA:
            oled_write("        MEDIA     ", false);
            break;
        case _SYSTEM:
            oled_write("       SYSTEM     ", false);
            break;
        default:
            break;
    }
}

void set_current_layer_oled(void) {
    uint16_t layer = get_highest_layer(layer_state | default_layer_state);
    set_oled_by_layer(layer);
}

void set_oled_text(void) {
    uint8_t mods                = get_mods();
    uint8_t oneshot_mods        = get_oneshot_mods();
    uint8_t oneshot_locked_mods = get_oneshot_locked_mods();

    bool isShift = mods & MOD_MASK_SHIFT || oneshot_mods & MOD_MASK_SHIFT || oneshot_locked_mods & MOD_MASK_SHIFT;
    bool isCtrl  = mods & MOD_MASK_CTRL || oneshot_mods & MOD_MASK_CTRL || oneshot_locked_mods & MOD_MASK_CTRL;
    bool isAlt   = mods & MOD_MASK_ALT || oneshot_mods & MOD_MASK_ALT || oneshot_locked_mods & MOD_MASK_ALT;
    bool isGui   = mods & MOD_MASK_GUI || oneshot_mods & MOD_MASK_GUI || oneshot_locked_mods & MOD_MASK_GUI;

    oled_set_cursor(0, 0);

    if (swapper.state != NONE || leader.isLeading || select_word.state != STATE_NONE || dyn_macro.recording != 0) {
        if (swapper.state != NONE) {
            oled_write("Swapper", false);
        } else if (leader.isLeading) {
            oled_write("Leader Key", false);
        } else if (select_word.state != STATE_NONE) {
            oled_write("Select Word / Line", false);
        } else if (dyn_macro.recording != 0) {
            oled_write("Dynamic Macro", false);
        }
    } else if (has_any_smart_case()) {
        oled_write("Smart Case", false);
    } else if (isShift || isCtrl || isAlt || isGui) {
        if (isShift) {
            oled_write("Shift ", false);
        }
        if (isCtrl) {
            oled_write("Ctrl ", false);
        }
        if (isGui) {
            if (is_macos()) {
                oled_write("Cmd ", false);
            } else {
                oled_write("Win ", false);
            }
        }
        if (isAlt) {
            oled_write("Alt ", false);
        }
    } else {
        set_current_layer_oled();
    }

    clear_oled();
}

bool oled_task_kb(void) {
    if (!oled_task_user()) {
        return false;
    }
    set_oled_text();
    return true;
}

oled_rotation_t oled_init_user(oled_rotation_t rotation) {
    return OLED_ROTATION_0;
}

